<!DOCTYPE html>
<html>
<head>
	<title>Easy Prayer</title>
	<meta charset="utf-8">
	<meta name="description" content="Easy Prayer, easy to use, lightweight (200KB), lightning fast, multi language, responsive, progressive web app.">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="apple-mobile-web-app-status-bar" content="#008b8b">
	<meta name="theme-color" content="#008b8b">
	<link rel="stylesheet" type="text/css" href="css/prayer.css">
	<link rel="apple-touch-icon" href="css/icons/prayer_96x96.png">
	<script src="js/adhan.js"></script>
	<!-- <link rel="manifest" href="prayer.json"> -->
</head>
<body>
	<nav id="nav_top">
		<i id="open_nav_left" class="nav_top_btn rb" title="Nav Left">q</i>
		<i id="program_info_btn" class="nav_top_btn rb" title="Program Info">a</i>
		<i id="top_btn" class="nav_top_btn rb" title="Top">t</i>
		<i id="bottom_btn" class="nav_top_btn rb" title="Bottom">d</i>
		<span><i class="nav_top_btn rb" id="bookmark_icon" title="Bookmark">b</i><span id="bookmark_container"></span></span>
		<i id="open_nav_right" class="nav_top_btn rb" title="Nav Right">s</i>
	</nav>
	<nav id="nav_left">
		<i class="rb close_btn right" id="close_nav_left">c</i>
		<dl class="settings">
			<dt id="country_list_label"></dt>
			<dd>
				<select id="country_list"></select>
			</dd>
			<dt id="city_list_label"></dt>
			<dd>
				<select id="city_list"></select>
			</dd>
			<dt></dt>
			<dd>
				<button type="button" class="btn btn_nav" id="left_reset_btn"></button>
			</dd>
		</dl>
	</nav>
	<nav id="nav_right">
		<i class="rb close_btn left" id="close_nav_right">c</i>
		<dl class="settings">
			<dt id="method_list_label"></dt>
			<dd>
				<select id="method_list">
					<option></option>
				</select>
			</dd>
			<dt id="asr_list_label"></dt>
			<dd>
				<select id="asr_list">
					<option value="hanafi">Hanefi</option>
					<option value="safi">Şafi</option>
				</select>
			</dd>
			<dt id="lat_input_label"></dt>
			<dd>
				<input type="text" id="lat" size="10" min="0" max="604" maxlength="10" pattern="\d{1,3}" title="Enlem">
			</dd>
			<dt id="lon_input_label"></dt>
			<dd>
				<input type="text" id="lon" size="10" min="0" max="604" maxlength="10" pattern="\d{1,3}" title="Boylam">
			</dd>
			<dt id="language_list_label"></dt>
			<dd>
				<select id="language_list"></select>
			</dd>
			<dt></dt>
			<dd>
				<button type="button" class="btn btn_nav" id="right_reset_btn"></button>
			</dd>
		</dl>
	</nav>
	<div class="container">
		<h4 id="header">Namaz Vakitleri</h4>
		<div id="prayer_times">
			<h5 id="prayer_place">
				Bulunduğunuz Yer: (
				<small><span id="prayer_city"></span></small>
				<small><span id="prayer_country"></span></small>
				)
			</h5>
			<table id="prayer_table">
			</table>
		</div>
	</div>
	<footer><a target="_blank" href="https://github.com/obozdag/prayer"><i class="rb logo" title="Easy Prayer">a</i> Easy Prayer</a></footer>
	<div class="overlay" id="program_info_popup">
		<div class="popup">
			<i id="close_popup_btn" class="rb close_btn right">c</i>
			<div id="program_info_content">
			</div>
		</div>
	</div>
	<script src="js/swipe.js"></script>
	<script src="js/lang.js"></script>
	<script src="js/settings.js"></script>
	<script src="js/prayer.js"></script>
	<!-- <script src="app.js"></script> -->
	<script type="text/javascript">
	let latitude = 50.840156;
	let longitude = 9.102757;

	// document.getElementById('prayer_city').innerHTML = 'Neustadt'
	// document.getElementById('prayer_country').innerHTML = '(Marburg Germany)'

	getPosition().then(position=>{
		lat = position.coords.latitude
		lon = position.coords.longitude
		showTimes(lat, lon)
		showPosition(lat, lon)
	})

	function getPosition(options)
	{
		//to get current position
		return new Promise(function(resolve, reject){
			navigator.geolocation.getCurrentPosition(resolve, reject, options)
		})
	}

	function showPosition(latitude, longitude)
	{
		document.getElementById('prayer_city').innerHTML = 'Enlem: ' + latitude.toFixed(4)
		document.getElementById('prayer_country').innerHTML = 'Boylam: ' + longitude.toFixed(4)
	}

	function showTimes(latitude, longitude)
	{
		var coordinates         = new adhan.Coordinates(latitude, longitude);
		var params              = adhan.CalculationMethod.MuslimWorldLeague();
		params.madhab           = adhan.Madhab.Shafi;
		params.highLatitudeRule = adhan.HighLatitudeRule.SeventhOfTheNight;

		fillTableHeaders();

		var date  = new Date();
		var today = new Date();

		for(i=0; i<7; i++)
		{
			date.setDate(today.getDate() + i);
			var prayerTimes   = new adhan.PrayerTimes(coordinates, date, params);
			var formattedTime = adhan.Date.formattedTime;
			month_name = (translations['tr']['months'][date.getMonth()])
			day = date.getDate() + ' ' + month_name;

			prayTimes = {
				'fajr'   : formattedTime(prayerTimes.fajr, +2),
				'sunrise': formattedTime(prayerTimes.sunrise, +2),
				'dhuhr'  : formattedTime(prayerTimes.dhuhr, +2),
				'asr'    : formattedTime(prayerTimes.asr, +2),
				'maghrib': formattedTime(prayerTimes.maghrib, +2),
				'isha'   : formattedTime(prayerTimes.isha, +2),
			}

			fillTableCells(day, prayTimes);

		}
	}

	function fillTableHeaders()
	{
		prayerNames = translations['tr']['prayer_names']
		headers = document.createElement('tr');
			th = document.createElement('th');
			th.textContent = translations['tr']['date'];
			headers.appendChild(th);
		createTableHeaders(headers, prayerNames);
		prayer_table = document.getElementById('prayer_table')
		prayer_table.appendChild(headers)
	}

	function createTableHeaders(trElement, prayerNames)
	{
		for ([value, text] of Object.entries(prayerNames))
		{
			th = document.createElement('th');
			th.textContent = text;
			trElement.appendChild(th);
		}
	}

	function fillTableCells(day, prayerTimes)
	{
		timeRow = document.createElement('tr');
			td = document.createElement('td');
			td.textContent = day;
			timeRow.appendChild(td);
		createTableCells(timeRow, prayerTimes);
		prayer_table = document.getElementById('prayer_table')
		prayer_table.appendChild(timeRow)
	}

	function createTableCells(trElement, prayerTimes)
	{
		for ([value, text] of Object.entries(prayerTimes))
		{
			td = document.createElement('td');
			td.textContent = text;
			trElement.appendChild(td);
		}
	}
	</script>
</body>
</html>
